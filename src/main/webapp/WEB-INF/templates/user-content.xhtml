<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:f="http://xmlns.jcp.org/jsf/core">

    <div class="user-dashboard">
        <h2>User Dashboard</h2>

        <h:panelGroup rendered="#{not empty userDashboardBean.tasksCreatedByUser}">
            <h3>Tasks Created by You</h3>
            <h:dataTable value="#{userDashboardBean.tasksCreatedByUser}" var="task">
                <h:column>
                    <f:facet name="header">Title</f:facet>
                    #{task.title}
                </h:column>

                <h:column>
                    <f:facet name="header">Assigned To</f:facet>
                    #{task.user.firstName} #{task.user.lastName}
                </h:column>

                <h:column>
                    <f:facet name="header">Status</f:facet>
                    #{task.status}
                </h:column>

                <h:column>
                    <f:facet name="header">Due Date</f:facet>
                    <h:outputText value="#{task.dueDate}">
                        <f:convertDateTime type="localDateTime" pattern="yyyy-MM-dd HH:mm"/>
                    </h:outputText>
                </h:column>

                <h:column>
                    <f:facet name="header">Tags</f:facet>
                    <ui:repeat value="#{task.tags}" var="tag">
                            <span style="background-color: #eee; padding: 2px 5px; margin-right: 5px; border-radius: 3px;">
                                #{tag.name}
                            </span>
                    </ui:repeat>
                </h:column>


                <h:column>
                    <h:commandButton value="Mark as Done" action="#{userDashboardBean.markTaskAsDone}">
                        <f:setPropertyActionListener target="#{userDashboardBean.selectedTaskId}"
                                                     value="#{task.id}"/>
                        <f:ajax execute="@form" render="@form markAsDone"/>
                    </h:commandButton>
                </h:column>

            </h:dataTable>
        </h:panelGroup>

        <!-- dashboard.xhtml -->
            <h:panelGroup id="taskList" rendered="#{not empty userDashboardBean.tasksCreatedByManager}">
                <f:event type="preRenderComponent" listener="#{userDashboardBean.loadTokens}"/>

                <h3>Tasks Created by Manager</h3>

                <h:panelGroup id="tokenInfo">
                    <h2>NUMBER OF REFUSE TOKENS: #{userDashboardBean.tokens.refuse_token}</h2>
                    <h2>NUMBER OF DELETE TOKENS: #{userDashboardBean.tokens.delete_token}</h2>
                </h:panelGroup>

                <h:dataTable id="taskTable" value="#{userDashboardBean.tasksCreatedByManager}" var="task">
                    <h:column>
                        <f:facet name="header">Title</f:facet>
                        #{task.title}
                    </h:column>

                    <h:column>
                        <f:facet name="header">Assigned To</f:facet>
                        #{task.user.firstName} #{task.user.lastName}
                    </h:column>

                    <h:column>
                        <f:facet name="header">Status</f:facet>
                        #{task.status}
                    </h:column>

                    <h:column>
                        <f:facet name="header">Due Date</f:facet>
                        <h:outputText value="#{task.dueDate}">
                            <f:convertDateTime type="localDateTime" pattern="yyyy-MM-dd HH:mm"/>
                        </h:outputText>
                    </h:column>

                    <h:column>
                        <f:facet name="header">Tags</f:facet>
                        <ui:repeat value="#{task.tags}" var="tag">
                            <span style="background-color: #eee; padding: 2px 5px; margin-right: 5px; border-radius: 3px;">
                                #{tag.name}
                            </span>
                        </ui:repeat>
                    </h:column>

                    <h:column>
                        <f:facet name="header">Is Refused</f:facet>
                        #{task.isRefused}
                    </h:column>

                    <h:column>
                        <h:commandButton value="Mark as Done" action="#{userDashboardBean.markTaskAsDone}">
                            <f:setPropertyActionListener target="#{userDashboardBean.selectedTaskId}"
                                                         value="#{task.id}"/>
                            <f:ajax execute="@form" render="@form markAsDone"/>
                        </h:commandButton>
                    </h:column>

                    <h:column>
                        <h:commandButton value="Refuse" action="#{userDashboardBean.refuseTask}">
                            <f:setPropertyActionListener target="#{userDashboardBean.selectedTaskId}"
                                                         value="#{task.id}"/>
                            <f:ajax execute="@form" render="@form Refuse"/>
                        </h:commandButton>
                    </h:column>

                    <h:column>
                        <h:commandButton value="Deletee" action="#{userDashboardBean.deleteTask}">
                            <f:setPropertyActionListener target="#{userDashboardBean.selectedTaskId}"
                                                         value="#{task.id}"/>
                            <f:ajax execute="@form" render="@form Delete"/>
                        </h:commandButton>
                    </h:column>

                </h:dataTable>
            </h:panelGroup>

            <!-- Messages panel -->
            <h:panelGroup id="messages">
                <h:messages globalOnly="true" styleClass="error-messages"/>
            </h:panelGroup>


    </div>

</ui:composition>